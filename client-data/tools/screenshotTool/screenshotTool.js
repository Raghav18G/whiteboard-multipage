var screenshotSVG = '<svg class="tool-icon-svg" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.5001 4.0001C6.23489 4.00013 5.98055 4.10549 5.79302 4.29302C5.60549 4.48055 5.50013 4.73489 5.5001 5.0001V10.0001C5.49823 10.1326 5.52271 10.2642 5.57212 10.3871C5.62154 10.5101 5.6949 10.622 5.78794 10.7164C5.88099 10.8108 5.99186 10.8857 6.11412 10.9368C6.23637 10.988 6.36758 11.0143 6.5001 11.0143C6.63262 11.0143 6.76383 10.988 6.88608 10.9368C7.00834 10.8857 7.11921 10.8108 7.21226 10.7164C7.3053 10.622 7.37866 10.5101 7.42808 10.3871C7.47749 10.2642 7.50197 10.1326 7.5001 10.0001V6.0001H11.5001C11.6326 6.00197 11.7642 5.97749 11.8871 5.92808C12.0101 5.87866 12.122 5.8053 12.2164 5.71226C12.3108 5.61921 12.3857 5.50834 12.4368 5.38608C12.488 5.26383 12.5143 5.13262 12.5143 5.0001C12.5143 4.86758 12.488 4.73637 12.4368 4.61412C12.3857 4.49186 12.3108 4.38099 12.2164 4.28794C12.122 4.1949 12.0101 4.12154 11.8871 4.07212C11.7642 4.02271 11.6326 3.99823 11.5001 4.0001H6.5001Z" fill="black"/><path d="M28.483 20.9864C28.2181 20.9906 27.9657 21.0996 27.7812 21.2897C27.5966 21.4797 27.495 21.7352 27.4986 22.0001V26.0001H23.4986C23.3661 25.9982 23.2345 26.0227 23.1116 26.0721C22.9886 26.1216 22.8767 26.1949 22.7823 26.288C22.6879 26.381 22.613 26.4919 22.5619 26.6141C22.5107 26.7364 22.4844 26.8676 22.4844 27.0001C22.4844 27.1326 22.5107 27.2638 22.5619 27.3861C22.613 27.5084 22.6879 27.6192 22.7823 27.7123C22.8767 27.8053 22.9886 27.8787 23.1116 27.9281C23.2345 27.9775 23.3661 28.002 23.4986 28.0001H28.4986C28.7638 28.0001 29.0182 27.8947 29.2057 27.7072C29.3932 27.5197 29.4986 27.2653 29.4986 27.0001V22.0001C29.5004 21.8663 29.4754 21.7335 29.425 21.6096C29.3746 21.4857 29.2998 21.3731 29.2051 21.2786C29.1104 21.1841 28.9977 21.1095 28.8737 21.0593C28.7496 21.0091 28.6168 20.9844 28.483 20.9864Z" fill="black"/><path d="M28.4845 12.9864C28.2196 12.9906 27.9672 13.0996 27.7826 13.2897C27.5981 13.4797 27.4965 13.7352 27.5001 14.0001V18.0001C27.4982 18.1326 27.5227 18.2642 27.5721 18.3872C27.6215 18.5101 27.6949 18.622 27.7879 18.7164C27.881 18.8108 27.9919 18.8857 28.1141 18.9369C28.2364 18.988 28.3676 19.0144 28.5001 19.0144C28.6326 19.0144 28.7638 18.988 28.8861 18.9369C29.0083 18.8857 29.1192 18.8108 29.2123 18.7164C29.3053 18.622 29.3787 18.5101 29.4281 18.3872C29.4775 18.2642 29.502 18.1326 29.5001 18.0001V14.0001C29.5019 13.8663 29.4769 13.7335 29.4265 13.6096C29.3761 13.4857 29.3013 13.3731 29.2066 13.2786C29.1119 13.1841 28.9992 13.1095 28.8752 13.0593C28.7511 13.0091 28.6183 12.9844 28.4845 12.9864Z" fill="black"/><path d="M23.4986 4.0001C23.3661 3.99823 23.2345 4.02271 23.1116 4.07212C22.9886 4.12154 22.8767 4.1949 22.7823 4.28794C22.6879 4.38099 22.613 4.49186 22.5619 4.61412C22.5107 4.73637 22.4844 4.86758 22.4844 5.0001C22.4844 5.13262 22.5107 5.26383 22.5619 5.38608C22.613 5.50834 22.6879 5.61921 22.7823 5.71226C22.8767 5.8053 22.9886 5.87866 23.1116 5.92808C23.2345 5.97749 23.3661 6.00197 23.4986 6.0001H27.4986V10.0001C27.4967 10.1326 27.5212 10.2642 27.5706 10.3871C27.62 10.5101 27.6934 10.622 27.7865 10.7164C27.8795 10.8108 27.9904 10.8857 28.1126 10.9368C28.2349 10.988 28.3661 11.0143 28.4986 11.0143C28.6311 11.0143 28.7623 10.988 28.8846 10.9368C29.0069 10.8857 29.1177 10.8108 29.2108 10.7164C29.3038 10.622 29.3772 10.5101 29.4266 10.3871C29.476 10.2642 29.5005 10.1326 29.4986 10.0001V5.0001C29.4986 4.73489 29.3932 4.48055 29.2057 4.29302C29.0182 4.10549 28.7638 4.00013 28.4986 4.0001H23.4986Z" fill="black"/><path d="M15.4986 4.0001C15.3661 3.99823 15.2345 4.02271 15.1116 4.07212C14.9886 4.12154 14.8767 4.1949 14.7823 4.28794C14.6879 4.38099 14.613 4.49186 14.5619 4.61412C14.5107 4.73637 14.4844 4.86758 14.4844 5.0001C14.4844 5.13262 14.5107 5.26383 14.5619 5.38608C14.613 5.50834 14.6879 5.61921 14.7823 5.71226C14.8767 5.8053 14.9886 5.87866 15.1116 5.92808C15.2345 5.97749 15.3661 6.00197 15.4986 6.0001H19.4986C19.6311 6.00197 19.7627 5.97749 19.8857 5.92808C20.0086 5.87866 20.1205 5.8053 20.2149 5.71226C20.3093 5.61921 20.3842 5.50834 20.4354 5.38608C20.4865 5.26383 20.5128 5.13262 20.5128 5.0001C20.5128 4.86758 20.4865 4.73637 20.4354 4.61412C20.3842 4.49186 20.3093 4.38099 20.2149 4.28794C20.1205 4.1949 20.0086 4.12154 19.8857 4.07212C19.7627 4.02271 19.6311 3.99823 19.4986 4.0001H15.4986Z" fill="black"/><path d="M8.5 13C6.8553 13 5.5 14.3553 5.5 16C3.8553 16 2.5 17.3553 2.5 19V25C2.5 26.6447 3.8553 28 5.5 28H17.5C19.1447 28 20.5 26.6447 20.5 25V19C20.5 17.3553 19.1447 16 17.5 16C17.5 14.3553 16.1447 13 14.5 13H8.5ZM8.5 15H14.5C15.0713 15 15.5 15.4287 15.5 16V17C15.5 17.2652 15.6054 17.5195 15.7929 17.7071C15.9805 17.8946 16.2348 18 16.5 18H17.5C18.0713 18 18.5 18.4287 18.5 19V25C18.5 25.5713 18.0713 26 17.5 26H5.5C4.9287 26 4.5 25.5713 4.5 25V19C4.5 18.4287 4.9287 18 5.5 18H6.5C6.76521 18 7.01955 17.8946 7.20708 17.7071C7.39461 17.5195 7.49997 17.2652 7.5 17V16C7.5 15.4287 7.9287 15 8.5 15Z" fill="black"/><path d="M11.5 18C9.855 18 8.5 19.355 8.5 21C8.5 22.645 9.855 24 11.5 24C13.145 24 14.5 22.645 14.5 21C14.5 19.355 13.145 18 11.5 18ZM11.5 20C12.0642 20 12.5 20.4359 12.5 21C12.5 21.5641 12.0642 22 11.5 22C10.9359 22 10.5 21.5641 10.5 21C10.5 20.4359 10.9359 20 11.5 20Z" fill="black"/></svg><label class="label-tool" style="font-size:10px;line-height: 2px;font-weight:400; margin-top: 14px;"><p>Screenshot</p></label>';
(function Screenshot() {
  let imgCount = 1;
  var xlinkNS = "http://www.w3.org/1999/xlink";
  var msg = {
    type: "doc",
    src: "",
    w: 100,
    h: 100,
    x:
      (100 + document.documentElement.scrollLeft) / Tools.scale + 10 * imgCount,
    y: (100 + document.documentElement.scrollTop) / Tools.scale + 10 * imgCount,
  };

  console.log("SCREENSHOT TOOL");

  function onStart() {
    let canvas = document.getElementById("canvas");
    console.log("CANVAS", canvas);
    html2canvas(canvas, {
      x: window.scrollX,
      y: window.scrollY,
      width: window.innerWidth,
      height: window.innerHeight,
    }).then(function (res) {
      console.log("AFTER CONVERTING RES", res);
      var dataURL = res.toDataURL();
      console.log("DATA URL", dataURL);
      var aspect = msg.w / msg.h;
      var img = Tools.createSVGElement("image");
      // img.id = msg.id;
      img.setAttribute("class", "layer-" + Tools.layer);
      img.setAttributeNS(xlinkNS, "href", dataURL);
      console.log("IMAGE TAG", img);
      img.x.baseVal.value = msg["x"];
      img.y.baseVal.value = msg["y"];
      img.setAttribute("width", 400 * aspect);
      img.setAttribute("height", 400);
      if (msg.transform) img.setAttribute("transform", msg.transform);
      Tools.group.appendChild(img);
      const createEl = document.createElement("a");
      createEl.href = dataURL;

      // This is the name of our downloaded file
      createEl.download = "download-this-screenshot";

      createEl.click();
      createEl.remove();
      console.log("aFTER APPENDING");
    });
  }

  Tools.add({
    name: "Screenshot",
    // "icon": "üñºÔ∏è",
    iconHTML: screenshotSVG,
    shortcuts: {
      changeTool: "s",
    },
    //   draw: draw,
    onstart: onStart,
    oneTouch: true,
  });
})();
