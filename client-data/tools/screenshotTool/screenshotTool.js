var screenshotSVG = '<svg class="tool-icon-svg" width="32" height="32"viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="7.33594" y="16.875" width="12.375" height="12.375" fill="#3399FF"/><rect x="5.08594" y="20.25" width="16.875" height="10.125" rx="1.125" fill="#3399FF"/><path d="M7.89855 4.50011C7.60019 4.50014 7.31406 4.61868 7.10309 4.82965C6.89212 5.04062 6.77358 5.32675 6.77355 5.62511V11.2501C6.77144 11.3992 6.79898 11.5472 6.85458 11.6855C6.91017 11.8239 6.9927 11.9498 7.09737 12.0559C7.20205 12.1621 7.32678 12.2464 7.46432 12.304C7.60186 12.3615 7.74946 12.3911 7.89855 12.3911C8.04764 12.3911 8.19524 12.3615 8.33278 12.304C8.47032 12.2464 8.59505 12.1621 8.69973 12.0559C8.8044 11.9498 8.88693 11.8239 8.94252 11.6855C8.99812 11.5472 9.02566 11.3992 9.02355 11.2501V6.75011H13.5236C13.6726 6.75222 13.8206 6.72468 13.959 6.66909C14.0973 6.6135 14.2232 6.53096 14.3294 6.42629C14.4355 6.32161 14.5199 6.19688 14.5774 6.05934C14.6349 5.92181 14.6646 5.7742 14.6646 5.62511C14.6646 5.47602 14.6349 5.32842 14.5774 5.19088C14.5199 5.05334 14.4355 4.92861 14.3294 4.82393C14.2232 4.71926 14.0973 4.63673 13.959 4.58114C13.8206 4.52555 13.6726 4.49801 13.5236 4.50011H7.89855Z" fill="#424242"/><path d="M32.6313 23.6095C32.3333 23.6142 32.0493 23.7369 31.8417 23.9507C31.6341 24.1644 31.5197 24.4519 31.5238 24.7499V29.2499H27.0238C26.8748 29.2478 26.7267 29.2753 26.5884 29.3309C26.4501 29.3865 26.3242 29.469 26.218 29.5737C26.1118 29.6784 26.0275 29.8031 25.97 29.9407C25.9124 30.0782 25.8828 30.2258 25.8828 30.3749C25.8828 30.524 25.9124 30.6716 25.97 30.8091C26.0275 30.9467 26.1118 31.0714 26.218 31.1761C26.3242 31.2807 26.4501 31.3633 26.5884 31.4189C26.7267 31.4745 26.8748 31.502 27.0238 31.4999H32.6488C32.9472 31.4999 33.2333 31.3813 33.4443 31.1704C33.6553 30.9594 33.7738 30.6732 33.7738 30.3749V24.7499C33.7759 24.5994 33.7477 24.45 33.691 24.3106C33.6343 24.1711 33.5502 24.0445 33.4436 23.9382C33.3371 23.8318 33.2103 23.7479 33.0708 23.6915C32.9312 23.635 32.7818 23.6072 32.6313 23.6095Z" fill="#424242"/><path d="M32.631 14.6095C32.333 14.6142 32.049 14.7369 31.8414 14.9507C31.6338 15.1645 31.5195 15.4519 31.5235 15.7499V20.2499C31.5214 20.399 31.549 20.547 31.6046 20.6853C31.6602 20.8236 31.7427 20.9496 31.8474 21.0557C31.952 21.1619 32.0768 21.2462 32.2143 21.3037C32.3519 21.3613 32.4995 21.3909 32.6485 21.3909C32.7976 21.3909 32.9452 21.3613 33.0828 21.3037C33.2203 21.2462 33.3451 21.1619 33.4497 21.0557C33.5544 20.9496 33.6369 20.8236 33.6925 20.6853C33.7481 20.547 33.7757 20.399 33.7735 20.2499V15.7499C33.7756 15.5994 33.7474 15.45 33.6907 15.3106C33.634 15.1711 33.5499 15.0445 33.4434 14.9382C33.3368 14.8318 33.21 14.7479 33.0705 14.6915C32.931 14.635 32.7815 14.6072 32.631 14.6095Z" fill="#424242"/><path d="M27.0238 4.50011C26.8748 4.49801 26.7267 4.52555 26.5884 4.58114C26.4501 4.63673 26.3242 4.71926 26.218 4.82393C26.1118 4.92861 26.0275 5.05334 25.97 5.19088C25.9124 5.32842 25.8828 5.47602 25.8828 5.62511C25.8828 5.7742 25.9124 5.92181 25.97 6.05934C26.0275 6.19688 26.1118 6.32161 26.218 6.42629C26.3242 6.53096 26.4501 6.6135 26.5884 6.66909C26.7267 6.72468 26.8748 6.75222 27.0238 6.75011H31.5238V11.2501C31.5217 11.3992 31.5493 11.5472 31.6049 11.6855C31.6604 11.8239 31.743 11.9498 31.8476 12.0559C31.9523 12.1621 32.0771 12.2464 32.2146 12.304C32.3521 12.3615 32.4997 12.3911 32.6488 12.3911C32.7979 12.3911 32.9455 12.3615 33.0831 12.304C33.2206 12.2464 33.3453 12.1621 33.45 12.0559C33.5547 11.9498 33.6372 11.8239 33.6928 11.6855C33.7484 11.5472 33.7759 11.3992 33.7738 11.2501V5.62511C33.7738 5.32675 33.6553 5.04062 33.4443 4.82965C33.2333 4.61868 32.9472 4.50014 32.6488 4.50011H27.0238Z" fill="#424242"/><path d="M18.0238 4.50011C17.8748 4.49801 17.7267 4.52555 17.5884 4.58114C17.4501 4.63673 17.3242 4.71926 17.218 4.82393C17.1118 4.92861 17.0275 5.05334 16.97 5.19088C16.9124 5.32842 16.8828 5.47602 16.8828 5.62511C16.8828 5.7742 16.9124 5.92181 16.97 6.05934C17.0275 6.19688 17.1118 6.32161 17.218 6.42629C17.3242 6.53096 17.4501 6.6135 17.5884 6.66909C17.7267 6.72468 17.8748 6.75222 18.0238 6.75011H22.5238C22.6729 6.75222 22.8209 6.72468 22.9592 6.66909C23.0976 6.6135 23.2235 6.53096 23.3297 6.42629C23.4358 6.32161 23.5201 6.19688 23.5777 6.05934C23.6352 5.92181 23.6648 5.7742 23.6648 5.62511C23.6648 5.47602 23.6352 5.32842 23.5777 5.19088C23.5201 5.05334 23.4358 4.92861 23.3297 4.82393C23.2235 4.71926 23.0976 4.63673 22.9592 4.58114C22.8209 4.52555 22.6729 4.49801 22.5238 4.50011H18.0238Z" fill="#424242"/><path d="M10.1484 14.625C8.29815 14.625 6.77344 16.1497 6.77344 18C4.92315 18 3.39844 19.5247 3.39844 21.375V28.125C3.39844 29.9753 4.92315 31.5 6.77344 31.5H20.2734C22.1237 31.5 23.6484 29.9753 23.6484 28.125V21.375C23.6484 19.5247 22.1237 18 20.2734 18C20.2734 16.1497 18.7487 14.625 16.8984 14.625H10.1484ZM10.1484 16.875H16.8984C17.5412 16.875 18.0234 17.3573 18.0234 18V19.125C18.0235 19.4234 18.142 19.7095 18.353 19.9205C18.5639 20.1314 18.8501 20.25 19.1484 20.25H20.2734C20.9161 20.25 21.3984 20.7323 21.3984 21.375V28.125C21.3984 28.7677 20.9161 29.25 20.2734 29.25H6.77344C6.13072 29.25 5.64844 28.7677 5.64844 28.125V21.375C5.64844 20.7323 6.13072 20.25 6.77344 20.25H7.89844C8.1968 20.25 8.48293 20.1314 8.6939 19.9205C8.90487 19.7095 9.02341 19.4234 9.02344 19.125V18C9.02344 17.3573 9.50572 16.875 10.1484 16.875Z" fill="#424242"/><path d="M13.5234 20.25C11.6728 20.25 10.1484 21.7744 10.1484 23.625C10.1484 25.4756 11.6728 27 13.5234 27C15.3741 27 16.8984 25.4756 16.8984 23.625C16.8984 21.7744 15.3741 20.25 13.5234 20.25ZM13.5234 22.5C14.1582 22.5 14.6484 22.9904 14.6484 23.625C14.6484 24.2596 14.1582 24.75 13.5234 24.75C12.8888 24.75 12.3984 24.2596 12.3984 23.625C12.3984 22.9904 12.8888 22.5 13.5234 22.5Z" fill="white"/></svg><label id="tool-screenshot-localization" class="label-tool" style="font-size:10px;line-height: 2px;font-weight:400; margin-top: 14px;"><p>Screenshot</p></label>';
(function Screenshot() {
  let imgCount = 1;
  var xlinkNS = "http://www.w3.org/1999/xlink";
  var msg = {
    type: "doc",
    src: "",
    w: 100,
    h: 100,
    x:
      (100 + document.documentElement.scrollLeft) / Tools.scale + 10 * imgCount,
    y: (100 + document.documentElement.scrollTop) / Tools.scale + 10 * imgCount,
  };

  console.log("SCREENSHOT TOOL");

  function onStart() {
    let canvas = document.getElementById("board");
    console.log("CANVAS", canvas);
    domtoimage.toJpeg(canvas, {
      width: window.innerWidth,
      height: window.innerHeight,
      bgcolor:"#fff"
    }).then(function (res) {
      console.log("AFTER CONVERTING RES", res);
      var dataURL = res
      console.log("DATA URL", dataURL);
      var aspect = msg.w / msg.h;
      var img = Tools.createSVGElement("image");
      // img.id = msg.id;
      img.setAttribute("class", "layer-" + Tools.layer);
      img.setAttributeNS(xlinkNS, "href", dataURL);
      console.log("IMAGE TAG", img);
      img.x.baseVal.value = msg["x"];
      img.y.baseVal.value = msg["y"];
      img.setAttribute("width", 400 * aspect);
      img.setAttribute("height", 400);
      if (msg.transform) img.setAttribute("transform", msg.transform);
      Tools.group.appendChild(img);
      const createEl = document.createElement("a");
      createEl.href = dataURL;

      // This is the name of our downloaded file
      createEl.download = "download-this-screenshot";

      createEl.click();
      createEl.remove();
      console.log("aFTER APPENDING");
    });
  }

  Tools.add({
    name: "Screenshot",
    // "icon": "üñºÔ∏è",
    iconHTML: screenshotSVG,
    // shortcuts: {
    //   changeTool: "s",
    // },
    //   draw: draw,
    onstart: onStart,
    oneTouch: true,
  });
})();
